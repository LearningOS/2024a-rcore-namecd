# 功能

根据`translated_byte_buffer`重新实现了`sys_task_info` 和`sys_get_time`。然后在`TaskManager`中添加两个函数用于实现`mmap`和`munmap`。实现逻辑都是先判断格式是否正确，添加的话要注意重复，删除要注意间隙。添加直接调用`MemorySet`实现的功能即可，删除的话要删除页表映射，然后直接在地址空间删除某段逻辑段就行，会自动回收释放

## 简答题
### 第一题
SV39页表项组成为：
- [63 : 54] 是`Reserved` 字段，[ 53 : 10] 为`PPN`，即物理页号。[9 : 8] 为`RSW`字段，`Reserved for supervisor software`，最后 [7 : 0]为标志位。

标志位的作用： 
- `V(valid)`： 仅当位 V 为 1 时，页表项才是合法的 ；
- `R(Read)/W(Write)/X(eXecute)`：分别控制索引到这个页表项的对应虚拟页面是否允许读/写/执行；
- `U(User)`：控制索引到这个页表项的对应虚拟页面是否在 CPU 处于 U 特权级的情况下是否被允许访问；
- `G(Global)`：  全局位，表示对应的页面是否是全局的。 
- `A(Accessed)`：处理器记录自从页表项上的这一位被清零之后，页表项的对应虚拟页面是否被访问过；
- `D(Dirty)`：处理器记录自从页表项上的这一位被清零之后，页表项的对应虚拟页面是否被修改过。
### 第二题

2.1. 哪些异常是缺页导致的？
- 访问了一个虚拟地址，但是这个虚拟地址还没有映射到物理内存

2.2 发生缺页时，重要的相关寄存器的值：
 - `Satp`： 包含地址空间描述符和根页表所在的物理页号
 - `pc`： 保存出错的指令

2.3 好处
-  降低了内存的硬件要求，节省内存空间
-  加快程序的启动速度

2.4 占用的内存
- 10G / 4K  * （ 1 +  1 / 512 + 1 / 512 / 512） 
- 大概在3M字节左右
  

2.5 缺页处理
- 在用户进程申请内存空间时，先分配基本的页表结构，例如分配一级页表和二级页表
- 当用户第一次使用虚拟地址访问页面时，当作缺页，为这些页面分配物理页帧，并且更新页表项
- 如果遇到缺页时，从磁盘加载进内存来，需要用到相关的页面置换算法
  

2.6 swap

- 可以通过将页表项的有效位V置0，表示页面无效。这样就可以被`find_pte_create`构建新的页表项

### 第三题

   3.1  单页表更换页表

   - 通过`satp`寄存器，将对应地址空间的根页表项加载到`satp`，然后根据虚拟地址的`VPN`字段找到对应的地址。


   3.2   如何控制用户态无法访问内核页面？ 

   - 通过将页表的`PTEFlags`字段下的`U`字段置0，表示不允许用户态访问


   3.3  单页表有何优势？ 

   - 当应用程序对内核进行系统调用或接收到中断时，内核页表始终存在，因此可以避免大多数与上下文切换相关的开销（TLB 刷新、页表交换等） 

   3.4  双页表实现下，何时需要更换页表？假设你写一个单页表操作系统，你会选择何时更换页表（回答合理即可）？ 

   - 双页表下，任务切换和内核陷入时需要切换页表
   - 单页表下，只有任务切换才会需要切换页表

# 荣誉准则

1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 以下各位 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

   > 无


2. 此外，我也参考了 以下资料 ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

   >  无


3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。